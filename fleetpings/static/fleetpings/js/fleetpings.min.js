$(document).ready(()=>{"use strict";const checkboxPrePing=$("input#id_pre_ping");const checkboxFormupTimeNow=$("input#id_formup_now");const checkboxCreateSrpLink=$("input#id_srp_link");const checkboxCreateOptimer=$("input#id_optimer");const checkboxFleetSrp=$("input#id_srp");const inputCsrfMiddlewareToken=$('input[name="csrfmiddlewaretoken"]');const inputFormupTime=$("input#id_formup_time");const inputFormupTimestamp=$("input#id_formup_timestamp");inputFormupTime.datetimepicker({lang:fleetpingsSettings.dateTimeLocale,maskInput:true,format:"Y-m-d H:i",dayOfWeekStart:1,step:15});const getPingTargetsForCurrentUser=()=>{$.ajax({url:fleetpingsSettings.url.pingTargets,success:data=>{$("#id_ping_target").html(data)}})};const getWebhooksForCurrentUser=()=>{$.ajax({url:fleetpingsSettings.url.pingWebhooks,success:data=>{$("#id_ping_channel").html(data)}})};const getFleetTypesForCurrentUser=()=>{$.ajax({url:fleetpingsSettings.url.fleetTypes,success:data=>{$("#id_fleet_type").html(data)}})};const getFormupLocations=()=>{$.ajax({url:fleetpingsSettings.url.formupLocations,success:data=>{$("#id_formup_location").after(data)}})};const getFleetComms=()=>{$.ajax({url:fleetpingsSettings.url.fleetComms,success:data=>{$("#id_fleet_comms").after(data)}})};const getFleetDoctrines=()=>{$.ajax({url:fleetpingsSettings.url.fleetDoctrines,success:data=>{$("#id_fleet_doctrine").after(data)}})};const closeMessageElement=(element,closeAfter=10)=>{$(element).fadeTo(closeAfter*1e3,500).slideUp(500,()=>{$(this).slideUp(500,()=>{$(this).remove()})})};const showSuccess=(message,element)=>{$(element).html('<div class="alert alert-success alert-dismissable alert-message-success">'+'<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+message+"</div>");closeMessageElement(".alert-message-success")};const showError=(message,element)=>{$(element).html('<div class="alert alert-danger alert-dismissable alert-message-error">'+'<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+message+"</div>");closeMessageElement(".alert-message-error",9999)};const sanitizeInput=input=>{if(input){return input.replace(/<(|\/|[^>\/bi]|\/[^>bi]|[^\/>][^>]+|\/[^>][^>]+)>/g,"")}else{return input}};const getFormupTimestamp=formupTime=>{const formupDateTime=new Date(formupTime);return(formupDateTime.getTime()-formupDateTime.getTimezoneOffset()*60*1e3)/1e3};const copyFleetPing=()=>{const clipboardFleetPingData=new ClipboardJS("button#copyFleetPing");clipboardFleetPingData.on("success",e=>{showSuccess(fleetpingsTranslations.copyToClipboard.success,".aa-fleetpings-ping-copyresult");e.clearSelection();clipboardFleetPingData.destroy()});clipboardFleetPingData.on("error",()=>{showError(fleetpingsTranslations.copyToClipboard.error,".aa-fleetpings-ping-copyresult");clipboardFleetPingData.destroy()})};$(inputFormupTime).change(()=>{const formupTimestamp=getFormupTimestamp(sanitizeInput(inputFormupTime.val()));$(inputFormupTimestamp).val(formupTimestamp)});if(fleetpingsSettings.srpModuleAvailableToUser===true){if(checkboxFleetSrp.is(":checked")&&checkboxFormupTimeNow.is(":checked")){$(".fleetpings-create-srp-link").show("fast")}else{checkboxCreateSrpLink.prop("checked",false);$(".fleetpings-create-srp-link").hide("fast")}checkboxFleetSrp.change(()=>{if(checkboxFleetSrp.is(":checked")&&checkboxFormupTimeNow.is(":checked")){$(".fleetpings-create-srp-link").show("fast")}else{checkboxCreateSrpLink.prop("checked",false);$(".fleetpings-create-srp-link").hide("fast")}})}checkboxPrePing.on("change",()=>{if(checkboxPrePing.is(":checked")){checkboxFormupTimeNow.prop("checked",false);inputFormupTime.prop("disabled",false);if(fleetpingsSettings.optimerInstalled===true){$(".fleetpings-create-optimer").show("fast")}if(fleetpingsSettings.srpModuleAvailableToUser===true){checkboxCreateSrpLink.prop("checked",false);$(".fleetpings-create-srp-link").hide("fast")}}else{checkboxFormupTimeNow.prop("checked",true);inputFormupTime.prop("disabled",true);if(fleetpingsSettings.optimerInstalled===true){checkboxCreateOptimer.prop("checked",false);$(".fleetpings-create-optimer").hide("fast")}if(fleetpingsSettings.srpModuleAvailableToUser===true&&checkboxFleetSrp.is(":checked")){$(".fleetpings-create-srp-link").show("fast")}}});checkboxFormupTimeNow.on("change",()=>{if(checkboxFormupTimeNow.is(":checked")){checkboxPrePing.prop("checked",false);inputFormupTime.prop("disabled",true);if(fleetpingsSettings.optimerInstalled===true){checkboxCreateOptimer.prop("checked",false);$(".fleetpings-create-optimer").hide("fast")}if(fleetpingsSettings.srpModuleAvailableToUser===true&&checkboxFleetSrp.is(":checked")){$(".fleetpings-create-srp-link").show("fast")}}else{checkboxPrePing.prop("checked",true);inputFormupTime.prop("disabled",false);if(fleetpingsSettings.optimerInstalled===true){$(".fleetpings-create-optimer").show("fast")}if(fleetpingsSettings.srpModuleAvailableToUser===true){checkboxCreateSrpLink.prop("checked",false);$(".fleetpings-create-srp-link").hide("fast")}}});$("form").submit(event=>{event.preventDefault();let formData=$("#aa-fleetping-form").serializeArray().reduce((obj,item)=>{obj[item.name]=item.value;return obj},{});console.table(formData);$.ajax({url:fleetpingsSettings.url.fleetPing,type:"post",data:formData,headers:{"X-CSRFToken":inputCsrfMiddlewareToken.val()}})});$("button#copyFleetPing").on("click",()=>{copyFleetPing()});(()=>{getPingTargetsForCurrentUser();getWebhooksForCurrentUser();getFleetTypesForCurrentUser();getFormupLocations();getFleetComms();getFleetDoctrines()})()});