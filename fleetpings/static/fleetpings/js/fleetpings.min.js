$(document).ready(()=>{"use strict";const e=$("input#id_pre_ping"),t=$("input#id_formup_now"),n=$("input#id_srp_link"),l=$("input#id_optimer"),s=$("input#id_srp"),i=$("select#id_ping_target"),a=$("select#id_fleet_type"),r=$('input[name="csrfmiddlewaretoken"]'),p=$("input#id_fleet_commander"),o=$("input#id_fleet_name"),c=$("input#id_formup_time"),d=$("input#id_formup_timestamp"),g=$("input#id_formup_location"),f=$("input#id_fleet_doctrine"),m=$("input#id_fleet_doctrine_url"),u=$("input#id_webhook_embed_color"),h=(c.datetimepicker({lang:fleetpingsSettings.dateTimeLocale,maskInput:!0,format:"Y-m-d H:i",dayOfWeekStart:1,step:15}),(e,t=10)=>{$(e).fadeTo(1e3*t,500).slideUp(500,()=>{$(e).remove()})}),k=(e,t)=>{$(t).html(`<div class="alert alert-success alert-dismissible alert-message-success d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),h(".alert-message-success")},b=(e,t)=>{$(t).html(`<div class="alert alert-danger alert-dismissible alert-message-error d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),h(".alert-message-error",9999)},v=e=>e&&e.replace(/<(|\/|[^>/bi]|\/[^>bi]|[^/>][^>]+|\/[^>][^>]+)>/g,""),_=(t,s)=>{if(s=s||!1,t){let e=v(t).replace(/&/g,"&amp;");return!0===s&&(e=e.replace(/"/g,"&quot;")),e=!1===s?e.replace(/"/g,'\\"'):e}return t},y=e=>{const t=new Date(e);return(t.getTime()-60*t.getTimezoneOffset()*1e3)/1e3},S=()=>{const t=new ClipboardJS("button#copyFleetPing");t.on("success",e=>{k(fleetpingsTranslations.copyToClipboard.success,".aa-fleetpings-ping-copyresult"),e.clearSelection(),t.destroy()}),t.on("error",()=>{b(fleetpingsTranslations.copyToClipboard.error,".aa-fleetpings-ping-copyresult"),t.destroy()})};$(i).change(()=>{"@everyone"===i.val()?$(".hint-ping-everyone").show("fast"):$(".hint-ping-everyone").hide("fast")}),$(c).change(()=>{const e=y(v(c.val()));$(d).val(e)}),$(f).change(()=>{const e=v(f.val());let t=null;if(""!==e){const s=$('#fleetDoctrineList [value="'+_(e,!1)+'"]').data("doctrine-url");"undefined"!==s&&""!==s&&(t=s)}$(m).val(t)}),$(a).change(()=>{const e=$("option:selected",a);let t=null;""!==e&&(t=v(e.data("embed-color"))),$(u).val(t)}),!0===fleetpingsSettings.srpModuleAvailableToUser&&(s.is(":checked")&&t.is(":checked")?$(".fleetpings-create-srp-link").show("fast"):(n.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast")),s.change(()=>{s.is(":checked")&&t.is(":checked")?$(".fleetpings-create-srp-link").show("fast"):(n.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast"))})),e.on("change",()=>{e.is(":checked")?(t.prop("checked",!1),c.prop("disabled",!1),!0===fleetpingsSettings.optimerInstalled&&$(".fleetpings-create-optimer").show("fast"),!0===fleetpingsSettings.srpModuleAvailableToUser&&(n.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast"))):(t.prop("checked",!0),c.prop("disabled",!0),!0===fleetpingsSettings.optimerInstalled&&(l.prop("checked",!1),$(".fleetpings-create-optimer").hide("fast")),!0===fleetpingsSettings.srpModuleAvailableToUser&&s.is(":checked")&&$(".fleetpings-create-srp-link").show("fast"))}),t.on("change",()=>{t.is(":checked")?(e.prop("checked",!1),c.prop("disabled",!0),!0===fleetpingsSettings.optimerInstalled&&(l.prop("checked",!1),$(".fleetpings-create-optimer").hide("fast")),!0===fleetpingsSettings.srpModuleAvailableToUser&&s.is(":checked")&&$(".fleetpings-create-srp-link").show("fast")):(e.prop("checked",!0),c.prop("disabled",!1),!0===fleetpingsSettings.optimerInstalled&&$(".fleetpings-create-optimer").show("fast"),!0===fleetpingsSettings.srpModuleAvailableToUser&&(n.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast")))}),$("form").submit(e=>{if(e.preventDefault(),$(".fleetpings-form-message div").remove(),!0===fleetpingsSettings.srpModuleAvailableToUser&&n.is(":checked")){const s=[o.val(),f.val()];if(s.includes(""))return b(fleetpingsTranslations.srp.error.missingFields,".fleetpings-form-message"),!1}if(!0===fleetpingsSettings.optimerInstalled&&l.is(":checked")){const i=[o.val(),f.val(),g.val(),c.val(),p.val()];if(i.includes(""))return b(fleetpingsTranslations.optimer.error.missingFields,".fleetpings-form-message"),!1}const t=$("#aa-fleetping-form").serializeArray().reduce((e,t)=>(e[t.name]=t.value,e),{});$.ajax({url:fleetpingsSettings.url.fleetPing,type:"post",data:t,headers:{"X-CSRFToken":r.val()},success:e=>{!0===e.success?($(".aa-fleetpings-no-ping").hide("fast"),$(".aa-fleetpings-ping").show("fast"),$(".aa-fleetpings-ping-text").html(e.ping_context),e.message&&k(e.message,".fleetpings-form-message")):e.message?b(e.message,".fleetpings-form-message"):b("Something went wrong, no details given.",".fleetpings-form-message")}})}),$("button#copyFleetPing").on("click",()=>{S()})});
//# sourceMappingURL=fleetpings.min.js.map